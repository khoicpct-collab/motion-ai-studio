<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Motion AI Studio - Mô phỏng Vít Tải & Thiết bị</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="styles.css">
    <link rel="icon" type="image/x-icon" href="https://img.icons8.com/color/96/000000/conveyor-belt.png">
</head>
<body>
    <div class="container">
        <!-- HEADER -->
        <header class="header">
            <div class="logo">
                <i class="fas fa-industry"></i>
                <div>
                    <h1>Motion AI Studio</h1>
                    <p class="subtitle">Mô phỏng chuyển động vật liệu công nghiệp</p>
                </div>
            </div>
            <div class="header-controls">
                <div class="status-indicator active" id="statusIndicator">
                    <i class="fas fa-circle"></i>
                    <span>Ready</span>
                </div>
                <button id="helpBtn" class="btn-help">
                    <i class="fas fa-question-circle"></i> Hướng dẫn
                </button>
            </div>
        </header>

        <!-- MAIN CONTENT -->
        <div class="main-content">
            <!-- LEFT PANEL -->
            <div class="panel left-panel">
                <!-- UPLOAD SECTION -->
                <div class="section">
                    <h3><i class="fas fa-file-upload"></i> Tải file nền & vật liệu</h3>
                    <div class="upload-group">
                        <div class="upload-area" id="gifUploadArea">
                            <i class="fas fa-video"></i>
                            <p>Kéo thả GIF/Video làm nền</p>
                            <span class="file-types">.gif, .mp4, .webm, .jpg, .png</span>
                            <input type="file" id="uploadBackground" accept=".gif,.mp4,.webm,.jpg,.jpeg,.png" hidden>
                        </div>
                        
                        <div class="upload-area" id="materialUploadArea">
                            <i class="fas fa-pallet"></i>
                            <p>Kéo thả ảnh vật liệu</p>
                            <span class="file-types">.jpg, .png, .svg</span>
                            <input type="file" id="uploadMaterial" accept=".jpg,.jpeg,.png,.svg" hidden>
                        </div>
                        
                        <button id="loadScrewDemo" class="btn-primary">
                            <i class="fas fa-screwdriver"></i> Demo Vít Tải
                        </button>
                    </div>
                </div>

                <!-- DRAWING TOOLS -->
                <div class="section">
                    <h3><i class="fas fa-draw-polygon"></i> Công cụ vẽ vùng</h3>
                    <div class="tool-grid">
                        <button class="tool-btn active" data-tool="select" title="Chọn và di chuyển">
                            <i class="fas fa-mouse-pointer"></i>
                            <span>Select</span>
                        </button>
                        <button class="tool-btn" data-tool="pen" title="Vẽ vùng tự do">
                            <i class="fas fa-pen"></i>
                            <span>Pen Tool</span>
                        </button>
                        <button class="tool-btn" data-tool="rect" title="Vẽ vùng hình chữ nhật">
                            <i class="fas fa-square"></i>
                            <span>Rectangle</span>
                        </button>
                        <button class="tool-btn" data-tool="edit" title="Sửa điểm (như PowerPoint)">
                            <i class="fas fa-edit"></i>
                            <span>Edit Points</span>
                        </button>
                    </div>
                    
                    <div class="tool-options">
                        <div class="option">
                            <label>Độ dày nét: <span id="brushSizeValue">3</span>px</label>
                            <input type="range" id="brushSize" min="1" max="10" value="3" class="slider">
                        </div>
                        <button id="clearPathBtn" class="btn-secondary">
                            <i class="fas fa-trash"></i> Xóa vùng chọn
                        </button>
                    </div>
                </div>

                <!-- DEVICE PRESETS -->
                <div class="section">
                    <h3><i class="fas fa-cogs"></i> Mẫu thiết bị</h3>
                    <div class="preset-grid">
                        <button class="preset-btn active" data-preset="screw">
                            <i class="fas fa-screwdriver"></i>
                            <span>Vít tải</span>
                            <small>Chuyển động xoắn</small>
                        </button>
                        <button class="preset-btn" data-preset="conveyor">
                            <i class="fas fa-conveyor-belt"></i>
                            <span>Băng tải</span>
                            <small>Chuyển động thẳng</small>
                        </button>
                        <button class="preset-btn" data-preset="mixer">
                            <i class="fas fa-blender"></i>
                            <span>Máy trộn</span>
                            <small>Chuyển động hỗn hợp</small>
                        </button>
                        <button class="preset-btn" data-preset="vibrating">
                            <i class="fas fa-vihara"></i>
                            <span>Sàng rung</span>
                            <small>Rung và sàng</small>
                        </button>
                        <button class="preset-btn" data-preset="pump">
                            <i class="fas fa-tint"></i>
                            <span>Bơm</span>
                            <small>Chảy theo đường ống</small>
                        </button>
                    </div>
                </div>
            </div>

            <!-- CANVAS AREA -->
            <div class="canvas-container">
                <div class="canvas-header">
                    <div class="canvas-info">
                        <h3><i class="fas fa-play-circle"></i> Khu vực mô phỏng</h3>
                        <div class="canvas-stats">
                            <span id="canvasStats">Kích thước: 1920x1080</span>
                        </div>
                    </div>
                    <div class="canvas-controls">
                        <button id="zoomInBtn" class="btn-icon" title="Phóng to">
                            <i class="fas fa-search-plus"></i>
                        </button>
                        <button id="zoomOutBtn" class="btn-icon" title="Thu nhỏ">
                            <i class="fas fa-search-minus"></i>
                        </button>
                        <button id="resetViewBtn" class="btn-secondary">
                            <i class="fas fa-sync-alt"></i> Reset
                        </button>
                    </div>
                </div>
                
                <!-- CANVAS WRAPPER -->
                <div class="canvas-wrapper" id="canvasWrapper">
                    <canvas id="mainCanvas" width="1920" height="1080"></canvas>
                    <canvas id="drawCanvas" width="1920" height="1080"></canvas>
                    
                    <!-- DIRECTION ARROWS (Hiển thị khi vẽ) -->
                    <div class="direction-overlay" id="directionOverlay">
                        <div class="direction-grid">
                            <button class="dir-btn" data-dir="↖" title="Hướng Tây Bắc">↖</button>
                            <button class="dir-btn" data-dir="↑" title="Hướng Bắc">↑</button>
                            <button class="dir-btn" data-dir="↗" title="Hướng Đông Bắc">↗</button>
                            <button class="dir-btn" data-dir="←" title="Hướng Tây">←</button>
                            <button class="dir-btn" data-dir="○" title="Xoay tròn">○</button>
                            <button class="dir-btn" data-dir="→" title="Hướng Đông">→</button>
                            <button class="dir-btn" data-dir="↙" title="Hướng Tây Nam">↙</button>
                            <button class="dir-btn" data-dir="↓" title="Hướng Nam">↓</button>
                            <button class="dir-btn" data-dir="↘" title="Hướng Đông Nam">↘</button>
                        </div>
                    </div>
                    
                    <!-- INSTRUCTIONS -->
                    <div class="canvas-instruction" id="canvasInstruction">
                        <div class="instruction-content">
                            <h4><i class="fas fa-mouse-pointer"></i> Hướng dẫn vẽ vùng</h4>
                            <ol>
                                <li>Chọn công cụ vẽ (Pen hoặc Rectangle)</li>
                                <li><strong>Click chuột trái</strong> vào ảnh để bắt đầu vẽ</li>
                                <li>Giữ và kéo để tạo vùng chọn</li>
                                <li><strong>Double click</strong> để kết thúc vẽ</li>
                                <li>Sử dụng mũi tên để chọn hướng chuyển động</li>
                            </ol>
                        </div>
                    </div>
                </div>
                
                <!-- ANIMATION CONTROLS -->
                <div class="animation-controls">
                    <button id="playBtn" class="btn-play">
                        <i class="fas fa-play"></i> Xem trước
                    </button>
                    <button id="pauseBtn" class="btn-secondary" disabled>
                        <i class="fas fa-pause"></i> Tạm dừng
                    </button>
                    <button id="stopBtn" class="btn-stop">
                        <i class="fas fa-stop"></i> Dừng
                    </button>
                    
                    <div class="playback-controls">
                        <label>Speed:</label>
                        <input type="range" id="playbackSpeed" min="10" max="200" value="100" class="slider-small">
                        <span id="speedPercent">100%</span>
                    </div>
                    
                    <div class="loop-control">
                        <input type="checkbox" id="loopToggle" checked>
                        <label for="loopToggle">Lặp lại</label>
                    </div>
                </div>
            </div>

            <!-- RIGHT PANEL -->
            <div class="panel right-panel">
                <!-- MOTION SETTINGS -->
                <div class="section">
                    <h3><i class="fas fa-sliders-h"></i> Cài đặt chuyển động</h3>
                    
                    <div class="control-group">
                        <label>Hướng chuyển động</label>
                        <div class="direction-preview">
                            <div class="selected-direction" id="selectedDirection">↗</div>
                            <span id="directionText">Đông Bắc (45°)</span>
                        </div>
                    </div>

                    <div class="control-group">
                        <label>Tốc độ: <span id="motionSpeedValue">50</span>%</label>
                        <input type="range" id="motionSpeed" min="1" max="100" value="50" class="slider">
                    </div>

                    <div class="control-group">
                        <label>Số lượng hạt: <span id="particleCountValue">120</span></label>
                        <input type="range" id="particleCount" min="10" max="500" value="120" class="slider">
                    </div>

                    <div class="control-group">
                        <label>Kích thước vật liệu: <span id="materialSizeValue">15</span>px</label>
                        <input type="range" id="materialSize" min="5" max="50" value="15" class="slider">
                    </div>

                    <div class="control-group">
                        <label>Độ xoáy (cho vít tải): <span id="swirlValue">75</span>%</label>
                        <input type="range" id="swirlStrength" min="0" max="100" value="75" class="slider">
                    </div>
                </div>

                <!-- AI OPTIMIZATION -->
                <div class="section">
                    <h3><i class="fas fa-robot"></i> Tối ưu hóa AI</h3>
                    <div class="ai-actions">
                        <button id="aiDetectMotion" class="btn-ai">
                            <i class="fas fa-eye"></i> Phát hiện chuyển động
                        </button>
                        <button id="aiOptimizePath" class="btn-ai">
                            <i class="fas fa-magic"></i> Tối ưu đường đi
                        </button>
                        <button id="aiSuggestParams" class="btn-ai">
                            <i class="fas fa-lightbulb"></i> Đề xuất thông số
                        </button>
                    </div>
                    
                    <div class="ai-presets">
                        <button class="ai-preset-btn" data-preset="gentle">
                            <i class="fas fa-wind"></i> Nhẹ nhàng
                        </button>
                        <button class="ai-preset-btn" data-preset="intense">
                            <i class="fas fa-bolt"></i> Mạnh mẽ
                        </button>
                        <button class="ai-preset-btn" data-preset="natural">
                            <i class="fas fa-leaf"></i> Tự nhiên
                        </button>
                    </div>
                </div>

                <!-- EXPORT SECTION -->
                <div class="section">
                    <h3><i class="fas fa-file-export"></i> Xuất file kết quả</h3>
                    
                    <div class="export-format">
                        <button class="format-btn active" data-format="gif">
                            <i class="fas fa-film"></i> GIF động
                        </button>
                        <button class="format-btn" data-format="mp4">
                            <i class="fas fa-video"></i> MP4 Video
                        </button>
                        <button class="format-btn" data-format="png">
                            <i class="fas fa-image"></i> PNG Sequence
                        </button>
                    </div>
                    
                    <div class="export-settings">
                        <div class="setting">
                            <label>Chất lượng:</label>
                            <select id="qualitySelect">
                                <option value="low">Thấp (nhanh)</option>
                                <option value="medium" selected>Trung bình</option>
                                <option value="high">Cao</option>
                                <option value="ultra">Siêu nét</option>
                            </select>
                        </div>
                        
                        <div class="setting">
                            <label>FPS:</label>
                            <select id="fpsSelect">
                                <option value="12">12 FPS</option>
                                <option value="24">24 FPS</option>
                                <option value="30" selected>30 FPS</option>
                                <option value="60">60 FPS</option>
                            </select>
                        </div>
                        
                        <div class="setting">
                            <label>Thời lượng: <span id="durationValue">5</span>s</label>
                            <input type="range" id="durationSlider" min="1" max="30" value="5" class="slider">
                        </div>
                    </div>
                    
                    <button id="exportBtn" class="btn-export">
                        <i class="fas fa-download"></i> Xuất file kết hợp
                    </button>
                    
                    <div class="export-note">
                        <small><i class="fas fa-info-circle"></i> File xuất ra sẽ kết hợp GIF nền + chuyển động tạo thành 1 file duy nhất</small>
                    </div>
                </div>
            </div>
        </div>

        <!-- STATUS BAR -->
        <footer class="status-bar">
            <div class="status-item">
                <i class="fas fa-layer-group"></i>
                <span>Chế độ: <strong>Layer trên GIF</strong></span>
            </div>
            <div class="status-item">
                <i class="fas fa-draw-polygon"></i>
                <span>Vùng chọn: <strong id="selectionStatus">Chưa có</strong></span>
            </div>
            <div class="status-item">
                <i class="fas fa-cube"></i>
                <span>Vật liệu: <strong id="materialStatus">Chưa tải</strong></span>
            </div>
            <div class="status-item">
                <i class="fas fa-history"></i>
                <span>FPS: <strong id="fpsCounter">60</strong></span>
            </div>
            <div class="status-item">
                <i class="fas fa-database"></i>
                <span>Bộ nhớ: <strong id="memoryUsage">45MB</strong></span>
            </div>
        </footer>
    </div>

    <!-- MODALS -->
    <div id="tutorialModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2><i class="fas fa-graduation-cap"></i> Hướng dẫn sử dụng: Mô phỏng Vít Tải</h2>
                <button class="modal-close">&times;</button>
            </div>
            <div class="modal-body">
                <div class="tutorial-section">
                    <h3><i class="fas fa-screwdriver"></i> Ví dụ: Mô phỏng Vít Tải</h3>
                    <p>1. Tải lên <strong>file GIF vít tải</strong> làm background</p>
                    <p>2. Tải <strong>ảnh vật liệu</strong> (hạt, bột, viên nén)</p>
                    <p>3. Dùng <strong>Pen Tool</strong> vẽ vùng vật liệu chuyển động trong vít</p>
                    <p>4. Chọn hướng chuyển động <strong>xoắn ốc</strong> (↗ hoặc ○)</p>
                    <p>5. Điều chỉnh <strong>độ xoáy</strong> cho giống thực tế</p>
                    <p>6. Xuất file GIF kết hợp cả vít tải và vật liệu chuyển động</p>
                </div>
            </div>
        </div>
    </div>

    <div id="exportModal" class="modal">
        <div class="modal-content export-modal">
            <div class="modal-header">
                <h2><i class="fas fa-cogs"></i> Đang xuất file kết hợp...</h2>
            </div>
            <div class="modal-body">
                <div class="export-progress">
                    <div class="progress-bar">
                        <div class="progress-fill" id="exportProgressFill"></div>
                    </div>
                    <div class="progress-text" id="exportProgressText">Đang xử lý khung hình 1/150...</div>
                </div>
                
                <div class="export-details">
                    <div class="detail">
                        <span>Định dạng:</span>
                        <strong id="exportFormat">GIF</strong>
                    </div>
                    <div class="detail">
                        <span>Kích thước:</span>
                        <strong>1920x1080</strong>
                    </div>
                    <div class="detail">
                        <span>Thời lượng:</span>
                        <strong id="exportDuration">5 giây</strong>
                    </div>
                    <div class="detail">
                        <span>Kết hợp:</span>
                        <strong>GIF nền + Layer chuyển động</strong>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- NOTIFICATION CENTER -->
    <div class="notification-center" id="notificationCenter"></div>

    <script src="app.js"></script>
</body>
</html>
